<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Forge Clicker â€” Mega Ultimate Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#0a0800;color:#ffd700;font-family:'Press Start 2P',monospace;overflow:hidden;height:100vh;user-select:none;}

/* â”€â”€ MENU â”€â”€ */
#menuScreen{
  position:fixed;inset:0;background:radial-gradient(ellipse at center,#1a0c00 0%,#050300 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;z-index:200;
}
#menuScreen::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 3px,rgba(255,150,0,.02) 3px,rgba(255,150,0,.02) 4px);pointer-events:none;}
.menu-title{font-size:22px;color:#ffd700;text-shadow:0 0 30px #ff9500,0 0 60px #ff950044;text-align:center;line-height:1.6;animation:titleglow 2.5s ease-in-out infinite;}
@keyframes titleglow{0%,100%{text-shadow:0 0 20px #ff9500,0 0 40px #ff950033;}50%{text-shadow:0 0 40px #ffd700,0 0 80px #ff950066;}}
.menu-sub{font-size:8px;color:#ff9500;letter-spacing:2px;}
.menu-cookie{display:block;margin:8px auto;image-rendering:pixelated;animation:bobble 2s ease-in-out infinite;}
@keyframes bobble{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
.menu-btn{
  width:280px;background:#0f0800;border:2px solid #ff9500;
  color:#ffd700;padding:14px 8px;font-family:'Press Start 2P',monospace;
  font-size:9px;cursor:pointer;text-align:center;letter-spacing:1px;
  transition:all .18s;position:relative;overflow:hidden;
}
.menu-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,150,0,.08),transparent);transform:translateX(-100%);transition:transform .4s;}
.menu-btn:hover::before{transform:translateX(100%);}
.menu-btn:hover{background:#1f1400;border-color:#ffd700;color:#fff;box-shadow:0 0 20px #ff950044;transform:scale(1.02);}
.menu-btn.disabled{opacity:.35;cursor:not-allowed;pointer-events:none;}
.menu-divider{width:280px;height:1px;background:linear-gradient(90deg,transparent,#ff9500,transparent);}
.join-row{display:flex;gap:8px;width:280px;}
.join-input{flex:1;background:#0a0800;border:2px solid #4a3000;color:#ffd700;padding:10px 8px;font-family:'Press Start 2P',monospace;font-size:8px;outline:none;}
.join-input:focus{border-color:#ff9500;}
.join-input::placeholder{color:#3a2000;font-size:7px;}

/* â”€â”€ GAME â”€â”€ */
#gameScreen{display:none;flex-direction:column;height:100vh;}
#topbar{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;background:#080600;border-bottom:2px solid #3a2000;font-size:8px;flex-shrink:0;}
#main{display:flex;flex:1;overflow:hidden;min-height:0;}

/* Left panel */
#left{width:300px;display:flex;flex-direction:column;align-items:center;padding:12px 10px;background:#0a0800;border-right:2px solid #2a1800;flex-shrink:0;overflow-y:auto;gap:6px;}
#cookieCount{font-size:13px;color:#ffd700;text-align:center;line-height:1.7;}
#cpsDisplay{font-size:7px;color:#ff9500;text-align:center;}
canvas#bigCookie{cursor:pointer;display:block;margin:4px auto;image-rendering:pixelated;transition:transform .07s;filter:drop-shadow(0 0 16px #ff8800);}
canvas#bigCookie:active{transform:scale(.88) rotate(-5deg);}
canvas#goldenCookie{cursor:pointer;display:none;margin:6px auto;image-rendering:pixelated;animation:goldenpulse 1s ease-in-out infinite;}
@keyframes goldenpulse{0%,100%{filter:drop-shadow(0 0 10px gold);}50%{filter:drop-shadow(0 0 28px gold) brightness(1.4);}}
/* Tabs */
.tabs{display:flex;gap:2px;width:100%;margin-top:4px;}
.tab{flex:1;background:#0f0800;border:1px solid #2a1800;color:#664400;padding:5px 2px;font-family:'Press Start 2P',monospace;font-size:6px;cursor:pointer;text-align:center;transition:all .15s;}
.tab:hover{border-color:#ff9500;color:#ff9500;}
.tab.on{background:#1a0f00;border-color:#ff9500;color:#ffd700;}
.tab-content{width:100%;display:none;}
.tab-content.on{display:block;}
/* Upgrades */
.upg-btn{width:100%;background:#0f0800;border:1px solid #2a1800;padding:5px 7px;margin-bottom:3px;cursor:pointer;font-family:'Press Start 2P',monospace;font-size:6px;color:#ffd700;text-align:left;display:flex;justify-content:space-between;align-items:center;transition:all .12s;}
.upg-btn:hover:not(:disabled){background:#1a0f00;border-color:#ff9500;}
.upg-btn:disabled{opacity:.35;cursor:default;}
.upg-cost{color:#ff9500;}
/* Pets */
.pet-card{background:#0f0800;border:1px solid #2a1800;padding:6px;margin-bottom:4px;display:flex;align-items:center;gap:6px;font-size:7px;}
.pet-card.owned{border-color:#ff9500;}
.pet-icon{font-size:20px;}
.pet-info{flex:1;}
.pet-name{color:#ffd700;font-size:7px;margin-bottom:2px;}
.pet-stat{color:#996600;font-size:6px;}
.pet-btn{background:#1a0f00;border:1px solid #4a3000;color:#ff9500;padding:4px 6px;font-family:'Press Start 2P',monospace;font-size:5px;cursor:pointer;}
.pet-btn:hover{border-color:#ffd700;}
/* Stocks */
.stock-row{background:#0f0800;border:1px solid #2a1800;padding:6px;margin-bottom:3px;font-size:6px;}
.stock-name{color:#ffd700;margin-bottom:3px;font-size:7px;}
.stock-price{color:#ff9500;}
.stock-up{color:#00ff44;}
.stock-down{color:#ff2200;}
.stock-btns{display:flex;gap:4px;margin-top:4px;}
.stock-btn{flex:1;background:#0a0800;border:1px solid #2a1800;color:#ff9500;padding:3px;font-family:'Press Start 2P',monospace;font-size:5px;cursor:pointer;text-align:center;}
.stock-btn:hover{border-color:#ff9500;}
.owned-bar{height:3px;background:#1a0f00;margin-top:3px;}
.owned-fill{height:100%;background:#ff9500;transition:width .4s;}

/* Mid panel */
#mid{flex:1;padding:10px;overflow-y:auto;background:#080600;}
.section-title{font-size:9px;color:#ffd700;border-bottom:2px solid #2a1800;padding-bottom:5px;margin-bottom:8px;}
.building{display:flex;align-items:center;gap:7px;padding:7px;margin-bottom:5px;background:#0f0800;border:1px solid #2a1800;cursor:pointer;transition:all .14s;}
.building:hover:not(.locked){background:#1a1000;border-color:#ff9500;}
.building.locked{opacity:.28;}
.b-icon{font-size:24px;flex-shrink:0;}
.b-info{flex:1;min-width:0;}
.b-name{font-size:7px;color:#ffd700;margin-bottom:2px;}
.b-desc{font-size:5px;color:#664400;margin-bottom:2px;}
.b-cps{font-size:5px;color:#44aa44;}
.b-cost{font-size:6px;color:#ff9500;margin-top:2px;}
.b-owned{font-size:9px;color:#ff9500;font-weight:bold;}
/* Multi-buy bar */
#multiBuy{display:flex;gap:4px;margin-bottom:8px;}
.mb-btn{flex:1;background:#0f0800;border:1px solid #2a1800;color:#664400;padding:4px;font-family:'Press Start 2P',monospace;font-size:6px;cursor:pointer;text-align:center;}
.mb-btn.on{border-color:#ff9500;color:#ffd700;background:#1a0f00;}

/* Right panel */
#right{width:220px;background:#060500;border-left:2px solid #2a1800;padding:8px;overflow-y:auto;flex-shrink:0;display:flex;flex-direction:column;gap:6px;}
.r-sec{font-size:7px;color:#ff9500;border-bottom:1px solid #2a1800;padding-bottom:3px;margin-top:4px;}
.stat-row{font-size:6px;color:#664400;margin-bottom:3px;display:flex;justify-content:space-between;}
.stat-v{color:#ffd700;}
.ach{padding:3px 5px;margin-bottom:2px;border:1px solid;font-size:5px;line-height:1.6;}
.ach.got{border-color:#ffd700;background:#0f0a00;color:#ffd700;}
.ach.no{border-color:#1a1000;color:#2a1800;}
.prestige-btn{width:100%;background:#100020;border:2px solid #6600ff;padding:7px;cursor:pointer;font-family:'Press Start 2P',monospace;font-size:6px;color:#cc88ff;margin-top:6px;transition:all .15s;}
.prestige-btn:hover{background:#1a0040;border-color:#aa44ff;box-shadow:0 0 12px #6600ff44;}

/* Multiplayer overlay */
#mpOverlay{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:150;}
.mp-box{background:#0a0800;border:2px solid #ff9500;padding:24px;min-width:340px;font-size:8px;text-align:center;}
.mp-title{font-size:14px;color:#ffd700;margin-bottom:14px;}
.mp-code{font-size:22px;color:#ff9500;letter-spacing:8px;margin:12px 0;text-shadow:0 0 20px #ff9500;}
.mp-players{font-size:7px;color:#996600;margin-bottom:10px;}
.mp-player{padding:4px;border:1px solid #2a1800;margin:3px 0;color:#ffd700;font-size:7px;}
.mp-player.me{border-color:#ff9500;}
.mp-input{width:100%;background:#0a0800;border:2px solid #2a1800;color:#ffd700;padding:8px;font-family:'Press Start 2P',monospace;font-size:9px;letter-spacing:4px;text-align:center;margin-bottom:8px;outline:none;}
.mp-input:focus{border-color:#ff9500;}
.mp-btn{background:#0f0800;border:2px solid #ff9500;color:#ffd700;padding:8px 20px;font-family:'Press Start 2P',monospace;font-size:8px;cursor:pointer;margin:4px;transition:all .15s;}
.mp-btn:hover{background:#1f1400;box-shadow:0 0 16px #ff950044;}
.mp-status{font-size:7px;color:#ff9500;margin:6px 0;min-height:16px;}
.mp-bar{height:4px;background:#1a0f00;margin:4px 0;}
.mp-fill{height:100%;background:#ff9500;transition:width .5s;}

/* Toast */
#toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);pointer-events:none;z-index:999;display:flex;flex-direction:column;align-items:center;gap:5px;}
.tmsg{background:#0f0800;border:1px solid #ff9500;padding:6px 12px;font-family:'Press Start 2P',monospace;font-size:7px;color:#ffd700;animation:toastFade 2.8s ease forwards;}
@keyframes toastFade{0%{opacity:0;transform:translateY(10px);}15%{opacity:1;transform:translateY(0);}80%{opacity:1;}100%{opacity:0;}}

/* Particles */
#particles{position:fixed;inset:0;pointer-events:none;z-index:998;overflow:hidden;}
.spark{position:absolute;pointer-events:none;font-size:13px;animation:sparkfly .9s ease-out forwards;}
@keyframes sparkfly{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-60px) scale(.5);}}

/* Season banner */
#seasonBanner{font-size:7px;text-align:center;padding:3px;border:1px solid;animation:seasonpulse 2s ease-in-out infinite;}
@keyframes seasonpulse{0%,100%{opacity:.8;}50%{opacity:1;}}

/* Online badge */
#onlineBadge{font-size:7px;padding:2px 6px;border:1px solid #00ff44;color:#00ff44;display:none;}
</style>
</head>
<body>

<!-- â”€â”€ MAIN MENU â”€â”€ -->
<div id="menuScreen">
  <div class="menu-title">ğŸª FORGE CLICKER</div>
  <div class="menu-sub">MEGA ULTIMATE EDITION v7.0</div>
  <canvas class="menu-cookie" id="menuCookie" width="96" height="96"></canvas>
  <div style="font-size:7px;color:#664400;text-align:center;max-width:260px;line-height:1.8;">
    PIXEL FORGE GAMES
  </div>
  <div class="menu-divider"></div>
  <button class="menu-btn" onclick="startSolo()">ğŸ® PLAY SOLO</button>
  <button class="menu-btn" onclick="showHostMenu()">ğŸ“¡ HOST GAME</button>
  <div class="join-row">
    <input class="join-input" id="joinCode" placeholder="ROOM CODE" maxlength="6">
    <button class="menu-btn" style="width:auto;padding:10px 12px;font-size:7px;" onclick="joinGame()">JOIN</button>
  </div>
  <div class="menu-divider"></div>
  <div style="font-size:6px;color:#2a1800;text-align:center;">BUILDINGS Â· PETS Â· STOCKS Â· ACHIEVEMENTS Â· PRESTIGE</div>
  <a href="index.html" style="color:#2a1800;font-size:6px;text-decoration:none;margin-top:4px;">â† BACK TO PIXEL FORGE GAMES</a>
</div>

<!-- â”€â”€ MULTIPLAYER OVERLAY â”€â”€ -->
<div id="mpOverlay">
  <div class="mp-box">
    <div class="mp-title" id="mpTitle">HOST GAME</div>
    <div id="mpBody"></div>
  </div>
</div>

<!-- â”€â”€ GAME â”€â”€ -->
<div id="gameScreen">
  <div id="topbar">
    <span style="color:#ff9500;">ğŸª FORGE CLICKER</span>
    <div id="seasonBanner" style="border-color:#ff9500;color:#ff9500;">ğŸŒ¸ SPRING</div>
    <span id="onlineBadge">â— ONLINE</span>
    <span id="topCookies" style="font-size:9px;color:#ffd700;"></span>
    <a href="index.html" style="color:#664400;font-size:7px;text-decoration:none;">â† MENU</a>
    <button style="background:#0f0800;border:1px solid #2a1800;color:#664400;padding:4px 8px;font-family:'Press Start 2P',monospace;font-size:6px;cursor:pointer;" onclick="backToMenu()">QUIT</button>
  </div>
  <div id="main">
    <!-- LEFT -->
    <div id="left">
      <div id="cookieCount">0<br><span style="font-size:7px;color:#996600;">cookies</span></div>
      <div id="cpsDisplay">0 per second</div>
      <canvas id="bigCookie" width="128" height="128" onclick="clickCookie(event)"></canvas>
      <canvas id="goldenCookie" width="80" height="80" onclick="catchGolden()"></canvas>
      <!-- TABS -->
      <div class="tabs">
        <button class="tab on" onclick="switchTab('upgrades',this)">â¬† UPG</button>
        <button class="tab" onclick="switchTab('pets',this)">ğŸ¾ PETS</button>
        <button class="tab" onclick="switchTab('stocks',this)">ğŸ“ˆ STK</button>
      </div>
      <!-- Upgrades tab -->
      <div class="tab-content on" id="tab-upgrades">
        <div id="upgList"></div>
      </div>
      <!-- Pets tab -->
      <div class="tab-content" id="tab-pets">
        <div id="petList"></div>
      </div>
      <!-- Stocks tab -->
      <div class="tab-content" id="tab-stocks">
        <div id="stockList"></div>
      </div>
    </div>
    <!-- MID -->
    <div id="mid">
      <div class="section-title">ğŸ— BUILDINGS</div>
      <div id="multiBuy">
        <button class="mb-btn on" onclick="setMulti(1,this)">Ã—1</button>
        <button class="mb-btn" onclick="setMulti(10,this)">Ã—10</button>
        <button class="mb-btn" onclick="setMulti(100,this)">Ã—100</button>
        <button class="mb-btn" onclick="setMulti(-1,this)">MAX</button>
      </div>
      <div id="buildingList"></div>
    </div>
    <!-- RIGHT -->
    <div id="right">
      <div class="r-sec">ğŸ“Š STATS</div>
      <div id="statsPanel"></div>
      <div class="r-sec">ğŸ† ACHIEVEMENTS</div>
      <div id="achPanel"></div>
      <button class="prestige-btn" onclick="doPrestige()">â™» PRESTIGE<br><span style="font-size:5px;color:#aa88ff">Reset for +10% CPS forever</span></button>
    </div>
  </div>
</div>

<div id="toast"></div>
<div id="particles"></div>

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA (faithful to original)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BUILDINGS=[
  {name:'Cursor',   cost:15,       cps:0.1,  icon:'ğŸ‘†'},
  {name:'Grandma',  cost:100,      cps:0.5,  icon:'ğŸ‘µ'},
  {name:'Bakery',   cost:500,      cps:4,    icon:'ğŸª'},
  {name:'Farm',     cost:3000,     cps:8,    icon:'ğŸŒ¾'},
  {name:'Mine',     cost:10000,    cps:47,   icon:'â›ï¸'},
  {name:'Factory',  cost:50000,    cps:260,  icon:'ğŸ­'},
  {name:'AI Baker', cost:250000,   cps:1400, icon:'ğŸ¤–'},
  {name:'Bank',     cost:1e6,      cps:7800, icon:'ğŸ¦'},
  {name:'Temple',   cost:1e7,      cps:44000,icon:'â›©ï¸'},
  {name:'Portal',   cost:1e8,      cps:260000,icon:'ğŸŒ€'},
  {name:'Time Machine',cost:5e8,   cps:1.6e6,icon:'â°'},
  {name:'Antimatter',cost:2e9,     cps:1e7,  icon:'âš›ï¸'},
  {name:'Prism',    cost:1e10,     cps:6.5e7,icon:'ğŸ’'},
  {name:'Chancemaker',cost:5e10,   cps:4.3e8,icon:'ğŸ°'},
  {name:'Fractal',  cost:2.5e11,   cps:2.9e9,icon:'ğŸ”·'},
];
const UPGRADES=[
  {name:'Double Click',  cost:100,    type:'click', mult:2,    icon:'ğŸ–±ï¸'},
  {name:'Sugar Rush',    cost:500,    type:'cps',   mult:1.5,  icon:'ğŸ¬'},
  {name:'Freaky Pudding',cost:1000,   type:'random',mult:2,    icon:'ğŸ®'},
  {name:'Golden Touch',  cost:5000,   type:'golden',mult:2,    icon:'âœ¨'},
  {name:'Mega Brain',    cost:10000,  type:'cps',   mult:1.5,  icon:'ğŸ§ '},
  {name:'Cookie Wizard', cost:50000,  type:'click', mult:5,    icon:'ğŸ§™'},
  {name:'Time Warp',     cost:100000, type:'cps',   mult:2,    icon:'â°'},
  {name:'Divine Baker',  cost:500000, type:'all',   mult:3,    icon:'ğŸ‘¼'},
  {name:'Cosmic Cookie', cost:5e6,    type:'cps',   mult:10,   icon:'ğŸŒŒ'},
  {name:'Ultra Clicker', cost:5e7,    type:'click', mult:100,  icon:'ğŸ’¥'},
  {name:'Ultimate Cookie',cost:1e9,   type:'all',   mult:999,  icon:'ğŸŒŸ'},
];
const PETS={
  pixel_cat:   {name:'Pixel Cat',   icon:'ğŸ±',price:5000,   bonus:'cps',   mult:1.1, rarity:'COMMON'},
  pixel_dog:   {name:'Pixel Dog',   icon:'ğŸ¶',price:15000,  bonus:'click', mult:1.15,rarity:'COMMON'},
  pixel_bunny: {name:'Pixel Bunny', icon:'ğŸ°',price:50000,  bonus:'cps',   mult:1.25,rarity:'UNCOMMON'},
  pixel_bird:  {name:'Pixel Bird',  icon:'ğŸ¦',price:200000, bonus:'golden',mult:1.5, rarity:'RARE'},
  pixel_dragon:{name:'Pixel Dragon',icon:'ğŸ‰',price:1e6,    bonus:'all',   mult:2,   rarity:'EPIC'},
  pixel_phoenix:{name:'Pixel Phoenix',icon:'ğŸ”¥',price:1e7,  bonus:'all',   mult:1.5, rarity:'LEGENDARY'},
};
const STOCKS={
  CAKE:{name:'Cake Corp',    price:250,  owned:0, hist:[250], trend:1},
  CHOC:{name:'Choc Ltd',     price:500,  owned:0, hist:[500], trend:1},
  GOLD:{name:'Golden Ltd',   price:1000, owned:0, hist:[1000],trend:1},
  SUGAR:{name:'Sugar Inc',   price:180,  owned:0, hist:[180], trend:1},
  CREAM:{name:'Cream Co',    price:420,  owned:0, hist:[420], trend:1},
};
const ACHIEVEMENTS=[
  {id:'click_1',   name:'First Click',    desc:'Click once',          req:'clicks',  val:1,       reward:10,   icon:'ğŸ‘†'},
  {id:'click_100', name:'Click Master',   desc:'100 clicks',          req:'clicks',  val:100,     reward:500,  icon:'ğŸ’ª'},
  {id:'click_1k',  name:'Click Legend',   desc:'1,000 clicks',        req:'clicks',  val:1000,    reward:5000, icon:'ğŸ”¥'},
  {id:'click_10k', name:'Click God',      desc:'10,000 clicks',       req:'clicks',  val:10000,   reward:50000,icon:'âš¡'},
  {id:'c_100',     name:'Baby Baker',     desc:'Bake 100 cookies',    req:'total',   val:100,     reward:100,  icon:'ğŸª'},
  {id:'c_1k',      name:'Cookie Rookie',  desc:'Bake 1K cookies',     req:'total',   val:1000,    reward:1000, icon:'ğŸª'},
  {id:'c_1m',      name:'Cookie Millionaire',desc:'Bake 1M cookies',  req:'total',   val:1e6,     reward:1e6,  icon:'ğŸ’°'},
  {id:'c_1b',      name:'Cookie Billionaire',desc:'Bake 1B cookies',  req:'total',   val:1e9,     reward:1e9,  icon:'ğŸ‘‘'},
  {id:'bld_1',     name:'Constructor',    desc:'Buy 1 building',      req:'buildings',val:1,      reward:500,  icon:'ğŸ—ï¸'},
  {id:'bld_10',    name:'Builder',        desc:'Buy 10 buildings',    req:'buildings',val:10,     reward:5000, icon:'ğŸ˜ï¸'},
  {id:'bld_100',   name:'Architect',      desc:'Buy 100 buildings',   req:'buildings',val:100,    reward:100000,icon:'ğŸ™ï¸'},
  {id:'upg_1',     name:'Upgraded',       desc:'Buy 1 upgrade',       req:'upgrades', val:1,      reward:1000, icon:'â¬†ï¸'},
  {id:'upg_all',   name:'Max Upgraded',   desc:'Buy all upgrades',    req:'upgrades', val:11,     reward:1e7,  icon:'ğŸŒŸ'},
  {id:'pet_1',     name:'Pet Owner',      desc:'Adopt 1 pet',         req:'pets',     val:1,      reward:25000,icon:'ğŸ¾'},
  {id:'pet_all',   name:'Pet Collector',  desc:'Adopt all 6 pets',    req:'pets',     val:6,      reward:1e7,  icon:'ğŸ†'},
  {id:'golden_1',  name:'Lucky!',         desc:'Catch a golden cookie',req:'golden',  val:1,      reward:5000, icon:'âœ¨'},
  {id:'stock_1',   name:'Investor',       desc:'Buy a stock',         req:'stocks',   val:1,      reward:10000,icon:'ğŸ“ˆ'},
  {id:'prestige_1',name:'Reborn',         desc:'Prestige once',       req:'prestige', val:1,      reward:1e6,  icon:'â™»ï¸'},
  {id:'mp_1',      name:'Social Baker',   desc:'Play multiplayer',    req:'mp',       val:1,      reward:50000,icon:'ğŸ‘¥'},
];
const SEASONS=['spring','summer','fall','winter'];
const SEASON_EMOJI={spring:'ğŸŒ¸',summer:'â˜€ï¸',fall:'ğŸ‚',winter:'â„ï¸'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G={
  cookies:0, totalCookies:0, cps:0, clickPower:1,
  buildings:{},boughtUpgrades:[],ownedPets:[],activePet:null,
  clicks:0, totalClicks:0, goldenCaught:0,
  prestiges:0, prestigeBonus:1,
  season:'spring',frame:0,
  goldenVisible:false, goldenBoost:false, goldenBoostTimer:0,
  goldenNextSpawn:0,
  stocksBought:0, mpPlayed:0,
  multiBuy:1,
  online:false, roomCode:'', isHost:false, playerName:'Player'+Math.floor(Math.random()*9999), players:[],
};
BUILDINGS.forEach(b=>G.buildings[b.name]=0);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PIXEL COOKIE DRAWING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CPIX=[
  '...BBBBBBBB...',
  '..BCCCCCCCCB..',
  '.BCCCDDDDCCCB.',
  'BCCDDDDDDDCCB.',
  'BCDDDDXDDDCCB.',
  'BCDDDDDDDXDCB.',
  'BCCDDXDDDDCCB.',
  'BCDDDDDDDDDCB.',
  'BCDDDXDDDDDCB.',
  'BCDDDDDDXDDCB.',
  'BCCCDDDDDDCCB.',
  '.BCCCCCCCCCB.',
  '..BBBBBBBBB..',
  '...............',
];
const CMAP={B:'#3d1a00',C:'#8b4513',D:'#c8762a',X:'#1a0800'};
const CGOLD={B:'#7a5500',C:'#ffd700',D:'#ffe566',X:'#ff9500'};
function drawPixCookie(canvas,pal,anim){
  const ctx=canvas.getContext('2d');
  const S=Math.floor(canvas.width/CPIX[0].length);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const t=Date.now()*.002;
  const shine=anim?(Math.sin(t)*.12+.88):1;
  CPIX.forEach((row,y)=>[...row].forEach((ch,x)=>{
    if(ch==='.')return;
    const base=pal?pal[ch]:CMAP[ch];
    if(anim&&(ch==='C'||ch==='D')){
      const [r,g,b]=hexRGB(base);
      ctx.fillStyle=`rgb(${Math.floor(r*shine)},${Math.floor(g*shine)},${Math.floor(b*shine)})`;
    }else ctx.fillStyle=base;
    ctx.fillRect(x*S,y*S,S,S);
  }));
}
function hexRGB(hex){const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return[r,g,b];}
// Draw menu cookie (animated)
function animMenuCookie(){
  const c=document.getElementById('menuCookie');if(!c)return;
  drawPixCookie(c,null,true);
  if(document.getElementById('menuScreen').style.display!=='none')requestAnimationFrame(animMenuCookie);
}
animMenuCookie();
// Game cookie shimmer
let cookieAnimFrame;
function animGameCookie(){
  const c=document.getElementById('bigCookie');if(!c)return;
  drawPixCookie(c,null,true);
  cookieAnimFrame=requestAnimationFrame(animGameCookie);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMAT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmt(n){
  if(n>=1e12)return(n/1e12).toFixed(2)+'T';
  if(n>=1e9)return(n/1e9).toFixed(2)+'B';
  if(n>=1e6)return(n/1e6).toFixed(2)+'M';
  if(n>=1e3)return(n/1e3).toFixed(1)+'K';
  return Math.floor(n).toLocaleString();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MENU ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startSolo(){
  loadGame();
  document.getElementById('menuScreen').style.display='none';
  document.getElementById('gameScreen').style.display='flex';
  document.getElementById('onlineBadge').style.display='none';
  G.online=false;
  animGameCookie();
  drawPixCookie(document.getElementById('bigCookie'),null,false);
  drawPixCookie(document.getElementById('goldenCookie'),CGOLD,false);
  recalc();renderAll();
  gameLoop();
  toast('ğŸª Welcome to Forge Clicker! Click the cookie!');
}

function showHostMenu(){
  const code=Math.random().toString(36).slice(2,8).toUpperCase();
  G.roomCode=code;G.isHost=true;G.online=true;G.mpPlayed=1;
  document.getElementById('mpTitle').textContent='HOST GAME';
  document.getElementById('mpBody').innerHTML=`
    <div style="font-size:8px;color:#996600;margin-bottom:8px;">Your room code:</div>
    <div class="mp-code">${code}</div>
    <div class="mp-players">Share this code with friends!</div>
    <div id="mpPlayerList"></div>
    <div class="mp-bar"><div class="mp-fill" style="width:25%" id="mpFill"></div></div>
    <div class="mp-status" id="mpStatus">Waiting for players... (simulated)</div>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:10px;">
      <button class="mp-btn" onclick="launchHostGame()">â–¶ START GAME</button>
      <button class="mp-btn" style="border-color:#4a3000;color:#664400;" onclick="closeMp()">CANCEL</button>
    </div>`;
  document.getElementById('mpOverlay').style.display='flex';
  // Simulate players joining
  let joined=0;
  const names=['CookiePro','MegaBaker','GoldenSnap','CrunchMaster'];
  const sim=setInterval(()=>{
    if(joined>=3||!document.getElementById('mpOverlay').style.display==='flex'){clearInterval(sim);return;}
    joined++;
    const list=document.getElementById('mpPlayerList');
    if(list){
      list.innerHTML+='<div class="mp-player">'+names[joined-1]+' joined!</div>';
      document.getElementById('mpFill').style.width=(25+joined*20)+'%';
      document.getElementById('mpStatus').textContent=joined+' player(s) connected';
    }
  },2000);
}

function launchHostGame(){
  closeMp();
  startSolo();
  document.getElementById('onlineBadge').style.display='inline';
  G.players=[G.playerName,'CookiePro','MegaBaker'];
  toast('ğŸ“¡ Hosting! Room: '+G.roomCode);
}

function joinGame(){
  const code=document.getElementById('joinCode').value.trim().toUpperCase();
  if(code.length<4){toast('Enter a room code!');return;}
  G.roomCode=code;G.isHost=false;G.online=true;G.mpPlayed=1;
  document.getElementById('mpTitle').textContent='JOIN GAME';
  document.getElementById('mpBody').innerHTML=`
    <div style="font-size:8px;color:#996600;margin-bottom:8px;">Connecting to room:</div>
    <div class="mp-code">${code}</div>
    <div class="mp-status" id="mpStatus">Connecting...</div>
    <div class="mp-bar"><div class="mp-fill" id="mpFill" style="width:10%"></div></div>
    <div id="mpPlayerList"></div>
    <button class="mp-btn" style="border-color:#4a3000;color:#664400;margin-top:10px;" onclick="closeMp()">CANCEL</button>`;
  document.getElementById('mpOverlay').style.display='flex';
  // Simulate connection
  let prog=10;
  const msgs=['Connecting...','Finding host...','Authenticating...','Syncing game state...','Connected!'];
  let step=0;
  const sim=setInterval(()=>{
    prog=Math.min(100,prog+22);
    const fill=document.getElementById('mpFill');
    const status=document.getElementById('mpStatus');
    if(fill)fill.style.width=prog+'%';
    if(status)status.textContent=msgs[Math.min(step,msgs.length-1)];
    step++;
    if(prog>=100){
      clearInterval(sim);
      setTimeout(()=>{
        closeMp();
        startSolo();
        document.getElementById('onlineBadge').style.display='inline';
        G.players=['Host_'+code,'MegaBaker',G.playerName];
        toast('âœ… Joined room '+code+'!');
      },600);
    }
  },500);
}

function closeMp(){document.getElementById('mpOverlay').style.display='none';}
function backToMenu(){
  G.running=false;
  saveGame();
  document.getElementById('gameScreen').style.display='none';
  document.getElementById('menuScreen').style.display='flex';
  animMenuCookie();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE / LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveGame(){try{localStorage.setItem('forgeClicker7',JSON.stringify(G));}catch(e){}}
function loadGame(){try{const d=localStorage.getItem('forgeClicker7');if(d){const s=JSON.parse(d);Object.assign(G,s);}}catch(e){}}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function recalc(){
  let cps=0,clickMult=1,cpsMult=1;
  BUILDINGS.forEach(b=>{cps+=b.cps*(G.buildings[b.name]||0);});
  G.boughtUpgrades.forEach(name=>{
    const u=UPGRADES.find(x=>x.name===name);if(!u)return;
    if(u.type==='click')clickMult*=u.mult;
    if(u.type==='cps')cpsMult*=u.mult;
    if(u.type==='all'){clickMult*=u.mult;cpsMult*=u.mult;}
    if(u.type==='random')cpsMult*=u.mult;
  });
  // Pets
  G.ownedPets.forEach(key=>{
    const p=PETS[key];if(!p)return;
    if(p.bonus==='cps')cpsMult*=p.mult;
    if(p.bonus==='click')clickMult*=p.mult;
    if(p.bonus==='all'){cpsMult*=p.mult;clickMult*=p.mult;}
  });
  if(G.goldenBoost){cpsMult*=7;clickMult*=7;}
  cpsMult*=G.prestigeBonus;
  G.cps=cps*cpsMult;
  G.clickPower=clickMult*G.prestigeBonus;
}

function clickCookie(e){
  const earned=Math.max(1,G.clickPower);
  G.cookies+=earned;G.totalCookies+=earned;G.totalClicks++;G.clicks++;
  spawnSpark(e,'+'+fmt(earned));
  if(G.online)broadcastClick(earned);
}
function catchGolden(){
  if(!G.goldenVisible)return;
  G.goldenVisible=false;
  document.getElementById('goldenCookie').style.display='none';
  const bonus=Math.floor(G.cookies*.15+G.cps*900);
  G.cookies+=bonus;G.totalCookies+=bonus;G.goldenCaught++;
  G.goldenBoost=true;G.goldenBoostTimer=300;
  recalc();toast('âœ¨ Golden Cookie! +'+fmt(bonus)+' + 7Ã— boost!');
}
function spawnSpark(e,txt){
  const d=document.createElement('div');
  d.className='spark';d.textContent=txt;
  d.style.left=(e?e.clientX-20:window.innerWidth/2)+'px';
  d.style.top=(e?e.clientY-10:window.innerHeight/2)+'px';
  d.style.color='#ffd700';
  document.getElementById('particles').appendChild(d);
  setTimeout(()=>d.remove(),900);
}
function buyBuilding(name){
  const b=BUILDINGS.find(x=>x.name===name);if(!b)return;
  let qty=G.multiBuy===-1?maxBuy(b):G.multiBuy;
  const cost=b.cost*Math.pow(1.15,G.buildings[name]||0);
  const totalCost=calcBulkCost(b,qty);
  if(G.cookies<totalCost){toast('Not enough cookies!');return;}
  G.cookies-=totalCost;G.buildings[name]=(G.buildings[name]||0)+qty;
  recalc();renderBuildings();renderStats();checkAchs();
  saveGame();
}
function calcBulkCost(b,qty){
  let total=0,base=b.cost;
  const owned=G.buildings[b.name]||0;
  for(let i=0;i<qty;i++)total+=base*Math.pow(1.15,owned+i);
  return total;
}
function maxBuy(b){
  let qty=0,total=0,owned=G.buildings[b.name]||0;
  while(total+b.cost*Math.pow(1.15,owned+qty)<=G.cookies)qty++;
  return Math.max(1,qty);
}
function buyUpgrade(name){
  const u=UPGRADES.find(x=>x.name===name);if(!u)return;
  if(G.boughtUpgrades.includes(name)||G.cookies<u.cost){toast('Cannot buy!');return;}
  G.cookies-=u.cost;G.boughtUpgrades.push(name);
  recalc();renderUpgrades();renderStats();checkAchs();toast('â¬† '+name+' unlocked!');saveGame();
}
function buyPet(key){
  const p=PETS[key];if(!p||G.ownedPets.includes(key))return;
  if(G.cookies<p.price){toast('Not enough cookies!');return;}
  G.cookies-=p.price;G.ownedPets.push(key);
  recalc();renderPets();renderStats();checkAchs();toast('ğŸ¾ Adopted '+p.name+'!');saveGame();
}
function buyStock(key,amount){
  const s=STOCKS[key];if(!s)return;
  const cost=s.price*amount;
  if(G.cookies<cost){toast('Not enough cookies!');return;}
  G.cookies-=cost;s.owned+=amount;G.stocksBought++;
  checkAchs();renderStocks();saveGame();toast('ğŸ“ˆ Bought '+amount+'x '+s.name);
}
function sellStock(key,amount){
  const s=STOCKS[key];if(!s||s.owned<amount)return;
  s.owned-=amount;G.cookies+=s.price*amount;
  renderStocks();saveGame();toast('ğŸ’° Sold '+amount+'x '+s.name+' for '+fmt(s.price*amount));
}
function setMulti(n,btn){
  G.multiBuy=n;
  document.querySelectorAll('.mb-btn').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
}
function doPrestige(){
  if(G.totalCookies<1e9){toast('Need 1B total cookies to prestige!');return;}
  if(!confirm('Prestige? You lose everything but gain +10% permanent CPS!'))return;
  G.prestiges++;G.prestigeBonus=1+G.prestiges*.1;
  G.cookies=0;G.totalCookies=0;G.cps=0;G.clickPower=1;
  BUILDINGS.forEach(b=>G.buildings[b.name]=0);
  G.boughtUpgrades=[];G.goldenCaught=0;
  recalc();renderAll();checkAchs();
  toast('â™» Prestige '+G.prestiges+'! +'+Math.round(G.prestiges*10)+'% CPS forever!');saveGame();
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll(){renderBuildings();renderUpgrades();renderPets();renderStocks();renderStats();renderAchs();}
function switchTab(id,btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById('tab-'+id).classList.add('on');
}
function renderBuildings(){
  const el=document.getElementById('buildingList');el.innerHTML='';
  BUILDINGS.forEach(b=>{
    const owned=G.buildings[b.name]||0;
    const qty=G.multiBuy===-1?maxBuy(b):G.multiBuy;
    const cost=calcBulkCost(b,qty);
    const affordable=G.cookies>=cost;
    const div=document.createElement('div');
    div.className='building'+(affordable?'':' locked');
    div.onclick=()=>buyBuilding(b.name);
    div.innerHTML=`<div class="b-icon">${b.icon}</div>
      <div class="b-info">
        <div class="b-name">${b.name}</div>
        <div class="b-cps">+${fmt(b.cps)} cps each</div>
        <div class="b-cost">ğŸ’° ${fmt(cost)}${qty>1?' Ã—'+qty:''}</div>
      </div>
      <div class="b-owned">${owned}</div>`;
    el.appendChild(div);
  });
}
function renderUpgrades(){
  const el=document.getElementById('upgList');el.innerHTML='';
  UPGRADES.forEach(u=>{
    const bought=G.boughtUpgrades.includes(u.name);
    const btn=document.createElement('button');
    btn.className='upg-btn';btn.disabled=bought||G.cookies<u.cost;
    btn.innerHTML=`${u.icon} ${u.name}<span class="upg-cost">${bought?'âœ“':fmt(u.cost)}</span>`;
    btn.onclick=()=>buyUpgrade(u.name);
    el.appendChild(btn);
  });
}
function renderPets(){
  const el=document.getElementById('petList');el.innerHTML='';
  Object.entries(PETS).forEach(([key,p])=>{
    const owned=G.ownedPets.includes(key);
    const div=document.createElement('div');
    div.className='pet-card'+(owned?' owned':'');
    const rarityColor={COMMON:'#888',UNCOMMON:'#44ff44',RARE:'#4488ff',EPIC:'#cc44ff',LEGENDARY:'#ff8800'}[p.rarity]||'#888';
    div.innerHTML=`<div class="pet-icon">${p.icon}</div>
      <div class="pet-info">
        <div class="pet-name">${p.name}</div>
        <div class="pet-stat" style="color:${rarityColor}">${p.rarity}</div>
        <div class="pet-stat">+${Math.round((p.mult-1)*100)}% ${p.bonus.toUpperCase()}</div>
      </div>
      ${owned?'<span style="color:#00ff44;font-size:8px;">âœ“</span>':
        `<button class="pet-btn" onclick="buyPet('${key}')" ${G.cookies<p.price?'disabled':''}>
          ${fmt(p.price)}
        </button>`}`;
    el.appendChild(div);
  });
}
function renderStocks(){
  const el=document.getElementById('stockList');el.innerHTML='';
  Object.entries(STOCKS).forEach(([key,s])=>{
    const prev=s.hist.length>1?s.hist[s.hist.length-2]:s.price;
    const up=s.price>=prev;
    const pct=Math.abs(((s.price-prev)/prev)*100).toFixed(1);
    const div=document.createElement('div');div.className='stock-row';
    const barW=Math.min(100,(s.owned/100)*100);
    div.innerHTML=`<div class="stock-name">${key} â€” ${s.name}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span class="stock-price">ğŸ’° ${Math.floor(s.price)}</span>
        <span class="${up?'stock-up':'stock-down'}">${up?'â–²':'â–¼'}${pct}%</span>
        <span style="font-size:6px;color:#664400;">Owned: ${s.owned}</span>
      </div>
      <div class="owned-bar"><div class="owned-fill" style="width:${barW}%"></div></div>
      <div class="stock-btns">
        <button class="stock-btn" onclick="buyStock('${key}',1)" ${G.cookies<s.price?'disabled':''}>BUY 1</button>
        <button class="stock-btn" onclick="buyStock('${key}',10)" ${G.cookies<s.price*10?'disabled':''}>BUY 10</button>
        <button class="stock-btn" onclick="sellStock('${key}',1)" ${s.owned<1?'disabled':''}>SELL 1</button>
        <button class="stock-btn" onclick="sellStock('${key}',s.owned)" ${s.owned<1?'disabled':''} onclick="sellStock('${key}',${s.owned})">SELL ALL</button>
      </div>`;
    el.appendChild(div);
  });
}
function renderStats(){
  const el=document.getElementById('statsPanel');
  const totalBldgs=Object.values(G.buildings).reduce((a,b)=>a+b,0);
  const portVal=Object.values(STOCKS).reduce((a,s)=>a+s.price*s.owned,0);
  el.innerHTML=`
    <div class="stat-row"><span>Total baked</span><span class="stat-v">${fmt(G.totalCookies)}</span></div>
    <div class="stat-row"><span>CPS</span><span class="stat-v">${fmt(G.cps)}</span></div>
    <div class="stat-row"><span>Click power</span><span class="stat-v">${fmt(G.clickPower)}</span></div>
    <div class="stat-row"><span>Total clicks</span><span class="stat-v">${fmt(G.totalClicks)}</span></div>
    <div class="stat-row"><span>Buildings</span><span class="stat-v">${totalBldgs}</span></div>
    <div class="stat-row"><span>Upgrades</span><span class="stat-v">${G.boughtUpgrades.length}/${UPGRADES.length}</span></div>
    <div class="stat-row"><span>Pets</span><span class="stat-v">${G.ownedPets.length}/${Object.keys(PETS).length}</span></div>
    <div class="stat-row"><span>Golden ğŸª</span><span class="stat-v">${G.goldenCaught}</span></div>
    <div class="stat-row"><span>Portfolio</span><span class="stat-v">${fmt(portVal)}</span></div>
    <div class="stat-row"><span>Prestige</span><span class="stat-v">Ã—${G.prestiges} (+${Math.round((G.prestigeBonus-1)*100)}%)</span></div>
    ${G.online?`<div class="stat-row"><span>Room</span><span class="stat-v">${G.roomCode}</span></div>`:''}
  `;
}
function renderAchs(){
  const el=document.getElementById('achPanel');el.innerHTML='';
  ACHIEVEMENTS.forEach(a=>{
    const got=checkAch(a);
    const div=document.createElement('div');
    div.className='ach '+(got?'got':'no');
    div.textContent=got?a.icon+' '+a.name:'???';
    el.appendChild(div);
  });
}
function checkAch(a){
  if(a.req==='clicks')return G.totalClicks>=a.val;
  if(a.req==='total')return G.totalCookies>=a.val;
  if(a.req==='buildings')return Object.values(G.buildings).reduce((s,v)=>s+v,0)>=a.val;
  if(a.req==='upgrades')return G.boughtUpgrades.length>=a.val;
  if(a.req==='pets')return G.ownedPets.length>=a.val;
  if(a.req==='golden')return G.goldenCaught>=a.val;
  if(a.req==='stocks')return G.stocksBought>=a.val;
  if(a.req==='prestige')return G.prestiges>=a.val;
  if(a.req==='mp')return G.mpPlayed>=a.val;
  return false;
}
function checkAchs(){
  ACHIEVEMENTS.forEach(a=>{
    if(checkAch(a)&&!G['ach_'+a.id]){
      G['ach_'+a.id]=true;
      G.cookies+=a.reward;G.totalCookies+=a.reward;
      toast(a.icon+' Achievement: '+a.name+'! +'+fmt(a.reward));
    }
  });
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg){
  const d=document.createElement('div');d.className='tmsg';d.textContent=msg;
  document.getElementById('toast').appendChild(d);
  setTimeout(()=>d.remove(),2800);
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MULTIPLAYER MOCK (cookie sync)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function broadcastClick(amt){
  // In a real implementation this would use WebSockets
  // For now just show other player activity in log
  if(Math.random()<.03)toast('ğŸ‘¥ '+G.players[Math.floor(Math.random()*G.players.length)]+' clicked!');
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let lastTime=Date.now();
function gameLoop(){
  if(!G.running)return;
  requestAnimationFrame(gameLoop);
  const now=Date.now();
  const dt=(now-lastTime)/1000;lastTime=now;
  G.frame++;
  // CPS
  const gained=G.cps*dt;
  G.cookies+=gained;G.totalCookies+=gained;
  // Golden boost timer
  if(G.goldenBoostTimer>0){G.goldenBoostTimer--;if(G.goldenBoostTimer===0){G.goldenBoost=false;recalc();toast('Golden boost ended.');}}
  // Golden cookie spawn
  if(!G.goldenVisible&&now>G.goldenNextSpawn&&G.goldenNextSpawn>0){
    G.goldenVisible=true;
    const gc=document.getElementById('goldenCookie');
    gc.style.display='block';drawPixCookie(gc,CGOLD,false);
    G.goldenNextSpawn=now+(90000+Math.random()*90000);
    setTimeout(()=>{if(G.goldenVisible){G.goldenVisible=false;gc.style.display='none';}},15000);
  }
  if(G.goldenNextSpawn===0)G.goldenNextSpawn=now+30000;
  // Stock price update every 5s
  if(G.frame%300===0){
    Object.values(STOCKS).forEach(s=>{
      const chg=1+(Math.random()*.12-.06)*s.trend;
      s.price=Math.max(10,s.price*chg);
      s.trend=.8+Math.random()*.4;
      s.hist.push(s.price);if(s.hist.length>20)s.hist.shift();
    });
    renderStocks();
  }
  // Season change every 5min
  if(G.frame%18000===0){
    const si=(SEASONS.indexOf(G.season)+1)%4;
    G.season=SEASONS[si];
    const banner=document.getElementById('seasonBanner');
    banner.textContent=SEASON_EMOJI[G.season]+' '+G.season.toUpperCase();
    recalc();toast(SEASON_EMOJI[G.season]+' Season: '+G.season+'!');
  }
  // Save every 30s
  if(G.frame%1800===0)saveGame();
  // UI every 5 frames
  if(G.frame%5===0){
    document.getElementById('cookieCount').innerHTML=fmt(G.cookies)+'<br><span style="font-size:7px;color:#996600;">cookies</span>';
    document.getElementById('cpsDisplay').textContent=fmt(G.cps)+' per second';
    document.getElementById('topCookies').textContent=fmt(G.cookies)+'ğŸª';
    // Power display
    const pct=Math.round(G.prestigeBonus*100-100);
    document.getElementById('topCookies').title='Prestige bonus: +'+pct+'%';
  }
  if(G.frame%30===0){checkAchs();renderBuildings();renderStats();}
  if(G.frame%60===0)renderAchs();
}
G.running=true;
// Don't start loop until game screen shown
G.running=false;
</script>
</body>
</html>
